<!DOCTYPE html>
<!--
 @license
 Copyright 2019 Google LLC. All Rights Reserved.
 SPDX-License-Identifier: Apache-2.0
-->
<html>
  <head>
    <title>UWC 2.0</title>

    <script src = "employee.js"></script>
    <script src = "vehicle.js"></script>
    <script src = "task.js"></script>
    <script src = "mcp.js"></script>
    <script src = "auth.js"></script>
    <script type ="text/javascript">  
      while (loadDataFromFile() !=true) {};  
    </script>
    <link rel="stylesheet" type="text/css" href="http://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css" />
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js" type="text/javascript"></script>
  </head>
  <body >
    <button onclick = "logOut();"> Log out </button>
    <button onclick="document.location.href='create.html'"> Create task </button>
    <h1> Task assignment</h1>
    <table id="table_id" class="display">
        <thead>
            <tr>
                <th>Task ID</th>
                <th>Name</th>
                <th>EID</th>
                <th>Role</th>
                <th>Group</th>
                <th>MCP</th>
                <th>Vehicle</th>
                <th>Time Created</th>
                <th>Status</th>
                <th>Progress (%)</th>
                <th>Description</th>
                <th>Time Start</th>
                <th>Time Done</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
   

    <script type="text/javascript">
  window.onload = function() { 
    var table = $('#table_id').DataTable( {
    ajax: {
        url: 'task.json',
        dataSrc: ''
    },
    columnDefs:[{targets:[7,11,12], render: function (data) { return data?new Date(data*1000).toLocaleString('en-GB'):null;}} ],
    columns: [
    { data: "taskId"},
    { data: "employeeId", render: function (data) {return `<a onClick="getEmployeeById('${data}');">${getEmployeeById(data).fullName}</a>`}},
    { data: "employeeId"},
    { data: "employeeId", render: function (data) {return `<a onClick="getEmployeeById('${data}');">${getEmployeeById(data).role}</a>`}},
    { data: "employeeId", render: function (data) {let group = getEmployeeById(data).group; return (group)?group:"None";}},
    { data: "MCPs"},
    { data: "vehicleId",render: function (data) {return `<a onClick="getVehicleById('${data}');">${data}</a>`}},
    { data: "timeCreated" },
    { data: "status"},
    { data: "progress"},
    { data: "description"},
    { data: "timeStart"},
    { data: "timeDone"},
    {
                targets: -1,
                data: null,
                defaultContent: "<button> Recreate </button>",
                orderable:false
    },
    {
      data: "status",
      render: function (data) {return (data == "done")?"":"<button> Cancel </button>"},
      orderable:false
    }
  ]
} );
    } ;
    
  </script>      
  </body>
</html>
